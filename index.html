<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TrainLog Smart</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* --- –°–¢–ò–õ–ò --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #212121);
            color: var(--tg-theme-text-color, #ffffff);
            margin: 0; padding: 15px;
            display: flex; flex-direction: column; align-items: center;
        }

        .card {
            background: rgba(255, 255, 255, 0.08);
            padding: 15px; border-radius: 16px;
            width: 100%; box-sizing: border-box;
            margin-bottom: 15px; text-align: center;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è —Ü–∏—Ñ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stat-value { font-size: 24px; font-weight: bold; color: var(--tg-theme-button-color, #3390ec); }
        .stat-label { font-size: 12px; opacity: 0.7; }

        input {
            width: 100%; padding: 12px; margin: 5px 0;
            border-radius: 10px; border: 1px solid #444;
            background: var(--tg-theme-secondary-bg-color, #333);
            color: var(--tg-theme-text-color, #fff); box-sizing: border-box;
        }

        .main-btn {
            width: 100%; padding: 14px; margin-top: 10px;
            background-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none; border-radius: 10px; font-weight: 600; cursor: pointer;
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç "–¢—Ä–µ–Ω–µ—Ä–∞" */
        #coach-msg {
            font-style: italic; color: #4ade80; margin-top: 10px; min-height: 20px;
        }

        /* –≠–ª–µ–º–µ–Ω—Ç –∏—Å—Ç–æ—Ä–∏–∏ */
        .history-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: left; font-size: 14px;
        }
        .del-btn {
            background: none; border: none; font-size: 16px; cursor: pointer; padding: 5px;
        }
    </style>
</head>
<body>

    <div class="card" style="display: flex; justify-content: space-around;">
        <div>
            <div class="stat-value" id="total-tonnage">0</div>
            <div class="stat-label">–¢–æ–Ω–Ω–∞–∂ (–∫–≥)</div>
        </div>
        <div>
            <div class="stat-value" id="train-count">0</div>
            <div class="stat-label">–ü–æ–¥—Ö–æ–¥–æ–≤</div>
        </div>
    </div>

    <div class="card">
        <h3>–ó–∞–ø–∏—Å—å –ø–æ–¥—Ö–æ–¥–∞</h3>
        <input type="text" id="exercise-input" placeholder="–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ (–Ω–∞–ø—Ä. –ñ–∏–º)">
        <div style="display: flex; gap: 10px;">
            <input type="number" id="weight-input" placeholder="–í–µ—Å (–∫–≥)">
            <input type="number" id="reps-input" placeholder="–ü–æ–≤—Ç–æ—Ä—ã">
        </div>
        <button class="main-btn" onclick="saveData()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <div id="coach-msg"></div> </div>

    <div class="card">
        <h3 style="text-align: left; margin-bottom: 10px;">–ò—Å—Ç–æ—Ä–∏—è</h3>
        <div id="history-list"></div>
        <button onclick="clearData()" style="background: none; border: none; color: #ff5555; margin-top: 15px; font-size: 12px; cursor: pointer;">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –ë–∞–∑–∞ —Ñ—Ä–∞–∑ "–¢—Ä–µ–Ω–µ—Ä–∞"
        const phrases = [
            "–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! üí™", "–õ–µ–≥–∫–∏–π –≤–µ—Å, –¥–µ—Ç–∫–∞!", "–ú–æ—â—å —Ä–∞—Å—Ç–µ—Ç!", 
            "–ñ–µ–ª–µ–∑–æ –ø–æ–∫–æ—Ä—è–µ—Ç—Å—è —Ç–µ–±–µ!", "–ï—â–µ –æ–¥–∏–Ω —à–∞–≥ –∫ —Ü–µ–ª–∏!", 
            "–ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è!", "–ö—Ä–∞—Å–∞–≤—á–∏–∫, –∂–º–∏ –µ—â–µ!", "–°–∏–ª–∞ –µ—Å—Ç—å!"
        ];

        // –ó–∞–≥—Ä—É–∑–∫–∞
        let savedData = localStorage.getItem('train_log_v1');
        let workouts = savedData ? JSON.parse(savedData) : [];
        renderInterface();

        function saveData() {
            let ex = document.getElementById('exercise-input').value;
            let w = parseFloat(document.getElementById('weight-input').value); // –ß–∏—Å–ª–æ
            let r = parseFloat(document.getElementById('reps-input').value); // –ß–∏—Å–ª–æ

            if(!ex || !w || !r) {
                tg.showAlert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!"); return;
            }

            // –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞: —Å—á–∏—Ç–∞–µ–º –æ–±—ä–µ–º (—Ç–æ–Ω–Ω–∞–∂)
            let vol = Math.round(w * r);

            let newRecord = {
                id: Date.now(),
                name: ex, w: w, r: r,
                vol: vol, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—ä–µ–º
                date: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };

            workouts.unshift(newRecord);
            updateStorage();

            // –ú–æ—Ç–∏–≤–∞—Ü–∏—è
            const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];
            document.getElementById('coach-msg').innerText = randomPhrase;
            
            // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π
            document.getElementById('exercise-input').value = "";
            document.getElementById('weight-input').value = "";
            document.getElementById('reps-input').value = "";

            tg.HapticFeedback.notificationOccurred('success');
            renderInterface();
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏
        function deleteItem(id) {
            tg.showConfirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?", (ok) => {
                if(ok) {
                    workouts = workouts.filter(item => item.id !== id);
                    updateStorage();
                    renderInterface();
                }
            });
        }

        function updateStorage() {
            localStorage.setItem('train_log_v1', JSON.stringify(workouts));
        }

        function clearData() {
            tg.showConfirm("–£–¥–∞–ª–∏—Ç—å –í–°–Æ –∏—Å—Ç–æ—Ä–∏—é?", (ok) => {
                if(ok) {
                    localStorage.removeItem('train_log_v1');
                    workouts = [];
                    renderInterface();
                    document.getElementById('coach-msg').innerText = "";
                }
            });
        }

        function renderInterface() {
            // 1. –°—á–∏—Ç–∞–µ–º –æ–±—â–∏–π —Ç–æ–Ω–Ω–∞–∂ (–°—É–º–º–∞ –≤—Å–µ—Ö –ø–æ–¥—Ö–æ–¥–æ–≤)
            let totalVol = workouts.reduce((sum, item) => sum + (item.vol || 0), 0);
            
            // –ö—Ä–∞—Å–∏–≤–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–∞ (1000 -> 1 000)
            document.getElementById('total-tonnage').innerText = totalVol.toLocaleString();
            document.getElementById('train-count').innerText = workouts.length;

            // 2. –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞
            let listHTML = "";
            workouts.slice(0, 10).forEach(item => {
                // –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å —Å—Ç–∞—Ä–∞—è –∏ –Ω–µ—Ç –æ–±—ä–µ–º–∞, —Å—á–∏—Ç–∞–µ–º –Ω–∞ –ª–µ—Ç—É
                let v = item.vol || (item.w * item.r); 
                
                listHTML += `
                    <div class="history-item">
                        <div>
                            <b>${item.name}</b><br>
                            <span style="opacity:0.7">${item.w}–∫–≥ √ó ${item.r}</span> 
                            <span style="color: #3390ec; font-size: 12px; margin-left: 5px;">(Œ£ ${v}–∫–≥)</span>
                        </div>
                        <button class="del-btn" onclick="deleteItem(${item.id})">üóë</button>
                    </div>
                `;
            });

            document.getElementById('history-list').innerHTML = listHTML || '<p style="opacity: 0.5;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>';
        }
    </script>
</body>
</html>