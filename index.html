<!DOCTYPE html>
<html lang="ru" dir="ltr">
<head>
    <meta charset="UTF-8">
    <!-- –û—Ç–∫–ª—é—á–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äì —É–ª—É—á—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤ Telegram -->
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>IronPath‚ÄØ2.0</title>

    <!-- –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ SDK Telegram (—É—Å–∫–æ—Ä—è–µ–º –ø–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä) -->
    <link rel="preconnect" href="https://telegram.org">
    <script src="https://telegram.org/js/telegram-web-app.js" defer></script>

    <link rel="stylesheet" href="style.css">

    <!-- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ -->
    <script defer>
        window.addEventListener('error', e => {
            console.warn('–û—à–∏–±–∫–∞ JavaScript:', e.message,
                         '–≤ —Ñ–∞–π–ª–µ', e.filename, '—Å—Ç—Ä–æ–∫–∞', e.lineno);
        });
        window.addEventListener('unhandledrejection', e => {
            console.warn('–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ Promise‚Äë–∏—Å–∫–ª—é—á–µ–Ω–∏–µ:', e.reason);
        });
    </script>
</head>
<body>

    <div id="toast" class="hidden" role="alert" aria-live="assertive">üèÜ –ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥!</div>

    <!-- --------------------------------------------------------------------- -->
    <!--  –û–ù–ë–û–†–î–ò–ù–ì (–ø–µ—Ä–≤—ã–π —ç–∫—Ä–∞–Ω)                                            -->
    <!-- --------------------------------------------------------------------- -->
    <div id="screen-onboarding" class="screen">
        <div class="card center-card">
            <div>
                <div style="font-size:70px; margin-bottom:20px;">üõ°Ô∏è</div>
                <h2>IronPath</h2>
                <p>–§–∏–∫—Å–∏—Ä—É–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏.<br>–ü—Ä–æ–∫–∞—á–∏–≤–∞–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.<br>–°–ª–µ–¥–∏ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º.</p>
            </div>
            <button type="button"
                    class="btn btn-primary"
                    data-action="showScreen"
                    data-args='["screen-profile-setup"]'>–ù–∞—á–∞—Ç—å</button>
        </div>
    </div>

    <!-- --------------------------------------------------------------------- -->
    <!--  –°–¢–†–û–ô–ö–ê –ü–†–û–§–ò–õ–Ø (onboarding ‚Üí –≤–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö)                         -->
    <!-- --------------------------------------------------------------------- -->
    <div id="screen-profile-setup" class="screen hidden">
        <div class="card">
            <h2>–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h2>
            <p>–ù—É–∂–Ω–æ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –∫–∞–ª–æ—Ä–∏–π –∏ XP</p>
            <div id="setup-inputs-container"></div>
            <button type="button"
                    class="btn btn-primary"
                    style="margin-top:10px;"
                    data-action="saveProfile"
                    data-args='[true]'>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –Ω–∞—á–∞—Ç—å</button>
        </div>
    </div>

    <!-- --------------------------------------------------------------------- -->
    <!--  –†–ï–ó–£–õ–¨–¢–ê–¢ –¢–†–ï–ù–ò–†–û–í–ö–ò                                                -->
    <!-- --------------------------------------------------------------------- -->
    <div id="screen-result" class="screen hidden">
        <div class="card center-card">
            <div style="font-size:60px; margin-bottom:10px;">üèÜ</div>
            <h2 id="res-header-praise">–¢—ã –º–∞—à–∏–Ω–∞!</h2>
            <div id="res-diff-badge" class="diff-badge hidden"></div>

            <div class="xp-result-box">
                <div style="font-size:12px; opacity:0.7;">XP‚ÄØ–ü–æ–ª—É—á–µ–Ω–æ</div>
                <div style="font-size:42px; font-weight:900; color:var(--gold);" id="res-xp">+0</div>
            </div>

            <div class="stat-grid">
                <div><div class="stat-val" id="res-vol">0</div><div class="stat-label">–¢–æ–Ω–Ω–∞–∂</div></div>
                <div><div class="stat-val" id="res-kcal">0</div><div class="stat-label">–ö–∫–∞–ª</div></div>
                <div><div class="stat-val" id="res-time">0</div><div class="stat-label">–ú–∏–Ω</div></div>
            </div>

            <div id="res-tip"
                 class="hint-block visible"
                 style="text-align:left; margin-top:15px;"></div>
            <button type="button"
                    class="btn btn-primary"
                    style="margin-top:20px;"
                    data-action="closeResult">–û—Ç–ª–∏—á–Ω–æ</button>
        </div>
    </div>

    <!-- --------------------------------------------------------------------- -->
    <!--  –ì–õ–ê–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï (–≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω)                                 -->
    <!-- --------------------------------------------------------------------- -->
    <div id="main-app" class="screen hidden">

        <!-- ***** –¢–ê–ë ¬´–ì–µ—Ä–æ–π¬ª ***** -->
        <div id="tab-hero" class="tab-content active-tab">
            <div class="card">
                <div class="char-container">
                    <span class="char-icon" id="main-char-icon">üê£</span>
                    <div style="font-weight:bold; font-size:18px;" id="main-char-rank">–ù–æ–≤–∏—á–æ–∫</div>
                    <div class="xp-bar-bg"><div class="xp-bar-fill" id="xp-fill"></div></div>
                    <div style="display:flex; justify-content:space-between; font-size:11px; color:var(--tg-hint); margin-top:5px;">
                        <span id="main-char-xp">0 XP</span>
                        <span id="main-char-next">–¶–µ–ª—å: 500</span>
                    </div>
                </div>

                <div class="stat-grid">
                    <div><div class="stat-val" id="stat-xp">0</div><div class="stat-label">–í—Å–µ–≥–æ XP</div></div>
                    <div><div class="stat-val" id="stat-count">0</div><div class="stat-label">–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div></div>
                    <div><div class="stat-val" id="stat-lvl">1</div><div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div></div>
                </div>
            </div>

            <div class="card">
                <h3>–¢–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                <p id="hero-details" style="margin-bottom:0">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</p>
            </div>
        </div>

        <!-- ***** –¢–ê–ë ¬´–ó–∞–ª¬ª ***** -->
        <div id="tab-train" class="tab-content">
            <div class="card">
                <h3>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h3>
                <select id="select-cat" data-action="updateExList"></select>
                <select id="select-ex"  data-action="adaptInputs"></select>

                <div id="hints-container"></div>

                <div id="input-container-strength" class="input-row">
                    <div class="input-group">
                        <label id="label-w" class="input-label">
                            <span id="text-w-label">–í–µ—Å (–∫–≥)</span>
                            <span id="pr-display" class="pr-badge"></span>
                        </label>
                        <input type="number"
                               id="input-w"
                               placeholder="0"
                               autocomplete="off"
                               inputmode="decimal">
                    </div>

                    <div class="input-group">
                        <label id="label-r" class="input-label">–ü–æ–≤—Ç–æ—Ä—ã</label>
                        <input type="number"
                               id="input-r"
                               placeholder="0"
                               autocomplete="off"
                               inputmode="numeric">
                    </div>
                </div>

                <div id="input-container-cardio" class="hidden">
                    <div class="input-group">
                        <label class="input-label">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å</label>
                        <select id="input-cardio-intensity" class="btn"></select>
                    </div>
                    <div class="input-group">
                        <label class="input-label">–í—Ä–µ–º—è (–º–∏–Ω)</label>
                        <input type="number"
                               id="input-cardio-time"
                               placeholder="–ú–∏–Ω"
                               autocomplete="off"
                               inputmode="numeric">
                    </div>
                </div>

                <button type="button"
                        class="btn btn-primary"
                        style="margin-top:12px;"
                        data-action="addSet">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
            </div>

            <div id="current-session-block" class="card hidden">
                <h3 id="session-title">–°–µ–π—á–∞—Å: 0‚ÄØXP</h3>
                <div id="current-list"></div>
                <button type="button"
                        class="btn btn-success"
                        style="margin-top:15px;"
                        data-action="finishWorkout">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
            </div>
        </div>

        <!-- ***** –¢–ê–ë ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª ***** -->
        <div id="tab-stats" class="tab-content">
            <div class="card">
                <h3>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º—ã—à—Ü</h3>
                <div id="muscle-heatmap"
                     style="height:100px; background:rgba(255,255,255,0.05); border-radius:10px;
                            display:flex; align-items:center; justify-content:center;
                            color:var(--tg-hint); font-size:12px;">
                    üöß –ö–∞—Ä—Ç–∞ –º—ã—à—Ü (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
                </div>
            </div>

            <div class="card">
                <h3>–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h3>
                <div id="history-list"
                     style="max-height:400px; overflow-y:auto;"></div>
            </div>
        </div>

        <!-- ***** –¢–ê–ë ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏¬ª ***** -->
        <div id="tab-settings" class="tab-content">
            <div class="card">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h3>

                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label">–í–µ—Å (–∫–≥)</label>
                        <input type="number"
                               id="prof-weight"
                               placeholder="80"
                               autocomplete="off"
                               inputmode="decimal">
                    </div>
                    <div class="input-group">
                        <label class="input-label">–†–æ—Å—Ç (—Å–º)</label>
                        <input type="number"
                               id="prof-height"
                               placeholder="175"
                               autocomplete="off"
                               inputmode="numeric">
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label">–í–æ–∑—Ä–∞—Å—Ç</label>
                        <input type="number"
                               id="prof-age"
                               placeholder="25"
                               autocomplete="off"
                               inputmode="numeric">
                    </div>
                    <div class="input-group">
                        <label class="input-label">–ü–æ–ª</label>
                        <select id="prof-gender" class="btn">
                            <option value="male">–ú—É–∂—á–∏–Ω–∞</option>
                            <option value="female">–ñ–µ–Ω—â–∏–Ω–∞</option>
                        </select>
                    </div>
                </div>

                <label class="input-label">–¶–µ–ª—å</label>
                <select id="prof-goal" class="btn">
                    <option value="strength">–°–∏–ª–∞</option>
                    <option value="muscle">–ú–∞—Å—Å–∞</option>
                    <option value="health">–ó–¥–æ—Ä–æ–≤—å–µ</option>
                    <option value="fatloss">–ü–æ—Ö—É–¥–µ–Ω–∏–µ</option>
                </select>

                <button type="button"
                        class="btn btn-primary"
                        style="margin-top:10px;"
                        data-action="saveProfile"
                        data-args='[false]'>–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
            </div>

            <div class="card">
                <h3>–ó–æ–Ω–∞ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
                <button type="button"
                        class="btn btn-outline"
                        style="border-color:var(--red); color:var(--red);"
                        data-action="safeReset">üß® –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å (Reset)</button>
            </div>
        </div>

        <!-- ***** –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å–Ω–∏–∑—É ***** -->
        <nav class="bottom-nav">
            <div class="nav-item active"
                 aria-label="–ì–µ—Ä–æ–π"
                 data-action="switchTab"
                 data-tab-id="tab-hero">
                <div class="nav-icon">üõ°Ô∏è</div><span>–ì–µ—Ä–æ–π</span>
            </div>

            <div class="nav-item"
                 aria-label="–ó–∞–ª"
                 data-action="switchTab"
                 data-tab-id="tab-train">
                <div class="nav-icon">üí™
                    <div id="workout-badge" class="nav-badge hidden"></div>
                </div><span>–ó–∞–ª</span>
            </div>

            <div class="nav-item"
                 aria-label="–ò–Ω—Ñ–æ"
                 data-action="switchTab"
                 data-tab-id="tab-stats">
                <div class="nav-icon">üìä</div><span>–ò–Ω—Ñ–æ</span>
            </div>

            <div class="nav-item"
                 aria-label="–ú–µ–Ω—é"
                 data-action="switchTab"
                 data-tab-id="tab-settings">
                <div class="nav-icon">‚öôÔ∏è</div><span>–ú–µ–Ω—é</span>
            </div>
        </nav>
    </div>

    <!-- --------------------------------------------------------------------- -->
    <!--  –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã (defer ‚Üí –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML)          -->
    <!-- --------------------------------------------------------------------- -->
    <script src="db.js" defer></script>
    <script src="state.js" defer></script>
    <script src="logic.js" defer></script>
    <script src="ui.js" defer></script>

    <!-- –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π ‚Äì –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ -->
    <script defer>
        document.addEventListener('DOMContentLoaded', () => {
            // ¬´–û–±—ë—Ä—Ç–∫–∏¬ª –¥–ª—è –º–µ—Ç–æ–¥–æ–≤ UI/Logic, —á—Ç–æ–±—ã –∏—Ö –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—ã–∑—ã–≤–∞—Ç—å –∏–∑ –¥–µ–ª–µ–≥–∞—Ç–æ—Ä–∞
            const map = {
                showScreen: UI.showScreen.bind(UI),
                saveProfile: Logic.saveProfile.bind(Logic),
                addSet: Logic.addSet.bind(Logic),
                finishWorkout: Logic.finishWorkout.bind(Logic),
                deleteSet: Logic.deleteSet.bind(Logic),
                deleteHistoryItem: Logic.deleteHistoryItem.bind(Logic),
                closeResult: UI.closeResult.bind(UI),
                safeReset: Logic.safeReset.bind(Logic),

                // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∞–±–æ–≤
                switchTab: (tabId) => {
                    const navEl = document.querySelector(`.nav-item[data-tab-id="${tabId}"]`);
                    UI.switchTab(tabId, navEl);
                },

                updateExList: UI.updateExList.bind(UI),
                adaptInputs: UI.adaptInputs.bind(UI)
            };

            // –î–µ–ª–µ–≥–∏—Ä—É–µ–º –∫–ª–∏–∫–∏
            document.body.addEventListener('click', e => {
                const el = e.target.closest('[data-action]');
                if (!el) return;

                const action = el.dataset.action;
                let args = [];

                if (el.dataset.args) {
                    try {
                        args = JSON.parse(el.dataset.args);
                    } catch (err) {
                        console.warn('–ù–µ–≤–µ—Ä–Ω—ã–π JSON –≤ data-args:', el.dataset.args);
                    }
                }

                if (action in map) {
                    map[action](...args);
                }
            });

            console.log('DOM loaded, starting app...');
            if (typeof State !== 'undefined') {
                State.init();
            } else {
                alert('–û—à–∏–±–∫–∞: —Ñ–∞–π–ª state.js –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è.');
            }
        });
    </script>
</body>
</html>