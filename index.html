<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>IronPath 2.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="toast">üèÜ –ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥!</div>

    <div id="screen-onboarding" class="screen">
        <div class="card center-card">
            <div>
                <div style="font-size: 70px; margin-bottom: 20px;">üõ°Ô∏è</div>
                <h2>IronPath</h2>
                <p>–§–∏–∫—Å–∏—Ä—É–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏.<br>–ü—Ä–æ–∫–∞—á–∏–≤–∞–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.<br>–°–ª–µ–¥–∏ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º.</p>
            </div>
            <button class="btn btn-primary" onclick="UI.showScreen('screen-profile-setup')">–ù–∞—á–∞—Ç—å</button>
        </div>
    </div>

    <div id="screen-profile-setup" class="screen">
        <div class="card">
            <h2>–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h2>
            <p>–ù—É–∂–Ω–æ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–∞–ª–æ—Ä–∏–π –∏ XP</p>
            <div id="setup-inputs-container"></div> 
            <button class="btn btn-primary" style="margin-top: 10px;" onclick="Logic.saveProfile(true)">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –Ω–∞—á–∞—Ç—å</button>
        </div>
    </div>

    <div id="screen-result" class="screen">
        <div class="card center-card">
            <div style="font-size: 60px; margin-bottom: 10px;">üèÜ</div>
            <h2 id="res-header-praise">–¢—ã –º–∞—à–∏–Ω–∞!</h2>
            <div id="res-diff-badge" class="diff-badge hidden"></div>
            
            <div class="xp-result-box">
                <div style="font-size: 12px; opacity: 0.7;">XP –ü–æ–ª—É—á–µ–Ω–æ</div>
                <div style="font-size: 42px; font-weight: 900; color: var(--gold);" id="res-xp">+0</div>
            </div>

            <div class="stat-grid">
                <div><div class="stat-val" id="res-vol">0</div><div class="stat-label">–¢–æ–Ω–Ω–∞–∂</div></div>
                <div><div class="stat-val" id="res-kcal">0</div><div class="stat-label">–ö–∫–∞–ª</div></div>
                <div><div class="stat-val" id="res-time">0</div><div class="stat-label">–ú–∏–Ω</div></div>
            </div>
            
            <div id="res-tip" class="hint-block visible" style="text-align: left; margin-top: 15px;"></div>
            <button class="btn btn-primary" style="margin-top: 20px;" onclick="UI.closeResult()">–û—Ç–ª–∏—á–Ω–æ</button>
        </div>
    </div>

    <div id="main-app" class="screen hidden">
        
        <div id="tab-hero" class="tab-content active-tab">
            <div class="card">
                <div class="char-container">
                    <span class="char-icon" id="main-char-icon">üê£</span>
                    <div style="font-weight: bold; font-size: 18px;" id="main-char-rank">–ù–æ–≤–∏—á–æ–∫</div>
                    <div class="xp-bar-bg"><div class="xp-bar-fill" id="xp-fill"></div></div>
                    <div style="display:flex; justify-content:space-between; font-size: 11px; color: var(--tg-hint); margin-top: 5px;">
                        <span id="main-char-xp">0 XP</span>
                        <span id="main-char-next">–¶–µ–ª—å: 500</span>
                    </div>
                </div>
                <div class="stat-grid">
                    <div><div class="stat-val" id="stat-xp">0</div><div class="stat-label">–í—Å–µ–≥–æ XP</div></div>
                    <div><div class="stat-val" id="stat-count">0</div><div class="stat-label">–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div></div>
                    <div><div class="stat-val" id="stat-lvl">1</div><div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div></div>
                </div>
            </div>
            <div class="card">
                 <h3>–¢–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                 <p id="hero-details" style="margin-bottom:0">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>
        </div>

        <div id="tab-train" class="tab-content">
            <div class="card">
                <h3>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h3>
                <select id="select-cat" onchange="UI.updateExList()"></select>
                <select id="select-ex" onchange="UI.adaptInputs()"></select>
                
                <div id="hints-container"></div> <div id="input-container-strength" class="input-row">
                    <div class="input-group">
                        <label id="label-w" class="input-label">
                            <span id="text-w-label">–í–µ—Å (–∫–≥)</span>
                            <span id="pr-display" class="pr-badge"></span>
                        </label>
                        <input type="number" id="input-w" inputmode="decimal">
                    </div>
                    <div class="input-group">
                        <label id="label-r" class="input-label">–ü–æ–≤—Ç–æ—Ä—ã</label>
                        <input type="number" id="input-r" inputmode="numeric">
                    </div>
                </div>

                <div id="input-container-cardio" class="hidden">
                    <div class="input-group">
                        <label class="input-label">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å</label>
                        <select id="input-cardio-intensity"></select>
                    </div>
                    <div class="input-group">
                        <label class="input-label">–í—Ä–µ–º—è (–º–∏–Ω)</label>
                        <input type="number" id="input-cardio-time" placeholder="–ú–∏–Ω" inputmode="numeric">
                    </div>
                </div>

                <button class="btn btn-primary" style="margin-top:12px;" onclick="Logic.addSet()">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
            </div>

            <div id="current-session-block" class="card hidden">
                <h3 id="session-title">–°–µ–π—á–∞—Å: 0 XP</h3>
                <div id="current-list"></div>
                <button class="btn btn-success" style="margin-top: 15px;" onclick="Logic.finishWorkout()">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
            </div>
        </div>

        <div id="tab-stats" class="tab-content">
             <div class="card">
                <h3>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º—ã—à—Ü</h3>
                <div id="muscle-heatmap" style="height: 100px; background: rgba(255,255,255,0.05); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--tg-hint); font-size: 12px;">
                    üöß –ö–∞—Ä—Ç–∞ –º—ã—à—Ü (–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
                </div>
            </div>

            <div class="card">
                <h3>–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h3>
                <div id="history-list" style="max-height: 400px; overflow-y: auto;"></div>
            </div>
        </div>

        <div id="tab-settings" class="tab-content">
            <div class="card">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label">–í–µ—Å (–∫–≥)</label>
                        <input type="number" id="prof-weight" placeholder="80" inputmode="decimal">
                    </div>
                    <div class="input-group">
                        <label class="input-label">–†–æ—Å—Ç (—Å–º)</label>
                        <input type="number" id="prof-height" placeholder="175" inputmode="numeric">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label">–í–æ–∑—Ä–∞—Å—Ç</label>
                        <input type="number" id="prof-age" placeholder="25" inputmode="numeric">
                    </div>
                    <div class="input-group">
                        <label class="input-label">–ü–æ–ª</label>
                        <select id="prof-gender">
                            <option value="male">–ú—É–∂—á–∏–Ω–∞</option>
                            <option value="female">–ñ–µ–Ω—â–∏–Ω–∞</option>
                        </select>
                    </div>
                </div>
                <label class="input-label">–¶–µ–ª—å</label>
                <select id="prof-goal">
                    <option value="strength">–°–∏–ª–∞</option>
                    <option value="muscle">–ú–∞—Å—Å–∞</option>
                    <option value="health">–ó–¥–æ—Ä–æ–≤—å–µ</option>
                    <option value="fatloss">–ü–æ—Ö—É–¥–µ–Ω–∏–µ</option>
                </select>
                <button class="btn btn-primary" style="margin-top: 10px;" onclick="Logic.saveProfile(false)">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
            </div>
            <div class="card">
                <h3>–ó–æ–Ω–∞ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
                <button class="btn btn-outline" style="border-color: var(--red); color: var(--red);" onclick="Logic.safeReset()">üß® –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å (Reset)</button>
            </div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-item active" onclick="UI.switchTab('tab-hero', this)">
                <div class="nav-icon">üõ°Ô∏è</div>
                <span>–ì–µ—Ä–æ–π</span>
            </div>
            <div class="nav-item" onclick="UI.switchTab('tab-train', this)">
                <div class="nav-icon">üí™
                    <div id="workout-badge" class="nav-badge hidden"></div>
                </div>
                <span>–ó–∞–ª</span>
            </div>
            <div class="nav-item" onclick="UI.switchTab('tab-stats', this)">
                <div class="nav-icon">üìä</div>
                <span>–ò–Ω—Ñ–æ</span>
            </div>
            <div class="nav-item" onclick="UI.switchTab('tab-settings', this)">
                <div class="nav-icon">‚öôÔ∏è</div>
                <span>–ú–µ–Ω—é</span>
            </div>
        </nav>
    </div>

    <script src="db.js"></script>
    <script src="state.js"></script>
    <script src="ui.js"></script>
    <script src="logic.js"></script>

    <script>
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            State.init();
        });
    </script>
</body>
</html>